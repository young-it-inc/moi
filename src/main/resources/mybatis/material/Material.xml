<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.youngit.office.api.material.mapper.MaterialMapper">

    <!-- 검색 조건 -->
    <sql id="searchMaterial">

    </sql>

    <!-- 자재 리스트 조회 및 검색 -->
    <select id="getOrSearchListMaterial" parameterType="materialSearchDto" resultType="MaterialModel">
        SELECT *
        FROM o_material
        WHERE is_used = 'Y'
    </select>

    <!-- 자재 리스트 조회 및 검색 카운트 -->
    <select id="countGetOrSearchListMaterial" parameterType="materialSearchDto" resultType="int">
        SELECT COUNT(*)
        FROM o_material
        WHERE is_used = 'Y'
    </select>

    <!-- 자재 개별 조회 -->
    <select id="getOneMaterial" resultType="MaterialModel">
        SELECT *
        FROM o_material
        WHERE material_uniq_id = #{materialUniqId}
    </select>

    <!-- 자재 등록 -->
    <insert id="registerMaterial" parameterType="MaterialModel">
        INSERT INTO o_material (material_uniq_id, asset_sort_code, product_sort_code, material_name, material_standard,
                                material_unit, material_unit_price,
                                created_at, created_by_member_uniq_id, updated_at, updated_by_member_uniq_id, is_used)
        VALUES(#{materialUniqId}, #{assetSortCode}, #{productSortCode}, #{materialName}, #{materialStandard},
               #{materialUnit}, #{materialUnitPrice},
               CURRENT_TIMESTAMP(3), #{createdByMemberUniqId}, CURRENT_TIMESTAMP(3), #{updatedByMemberUniqId},'Y')
    </insert>

    <!-- 최근 자재 고유ID 조회 -->
    <select id="getLastMaterialUniqId" resultType="String">
        SELECT MAX(material_uniq_id)
        FROM o_material
        -- where is_used = 'Y'
    </select>

    <!-- 자재 수정 -->
    <update id="updateMaterial" parameterType="MaterialModel">
        UPDATE o_material
        SET
            <if test="assetSortCode != null and assetSortCode != ''" >
                asset_sort_code = #{assetSortCode},
            </if>
            <if test="productSortCode != null and productSortCode != ''" >
                product_sort_code = #{productSortCode}
            </if>
            <if test="materialName != null and materialName != ''" >
                material_name = #{materialName},
            </if>
            <if test="materialStandard != null and materialStandard != ''" >
                material_standard = #{materialStandard},
            </if>
            <if test="materialUnit != null and materialUnit != ''" >
                material_unit = #{materialUnit},
            </if>
            <if test="materialUnitPrice != null and materialUnitPrice != ''" >
                material_unit_price = #{materialUnitPrice},
            </if>
            updated_at = CURRENT_TIMESTAMP(3),
            updated_by_member_uniq_id = #{updatedByMemberUniqId}
    </update>

    <!-- 자재 삭제 -->
    <update id="deleteMaterial" parameterType="String"> --사실상 update
        UPDATE o_material
        SET is_used = 'N'
        WHERE material_uniq_id = #{materialUniqId}
    </update>



</mapper>