<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.youngit.office.api.member.mapper.MemberMapper">


    <select id="getOrSearchListMember" parameterType="MemberSearchDto" resultType="MemberModel">
        select *
        from o_member
        where member_status = 'P'
    </select>



    <select id="countGetOrSearchListMember" resultType="int">
        select count(*)
        from o_member
        where member_status = 'P'
    </select>

    <select id="getOneMember" resultType="MemberModel">
    select *
    from o_member
   where 1=1
        <if test ="memberId != null and memberId !=''">
            and member_id = #{memberId}
        </if>
        <if test ="name != null and name !=''">
            and name = #{name}
    </if>
    <if test ="email != null and email !=''">
        and email = #{email}
    </if>
    <if test ="phoneNumber != null and phoneNumber !=''">
        and phone_number = #{phoneNumber}
    </if>

    </select>


    <insert id="registerMember" parameterType="MemberModel">
        INSERT INTO o_member (member_id, password, password_question, password_answer, member_name, member_email,member_phone_number, member_cellphone_number, member_status, member_type_code, group_id, authority_code, sign_up_at, member_uniq_id, position_code, department_code, task_code, cooperative_id)
        values (#{memberId},#{password},#{passwordQuestion},#{passwordAnswer},#{memberName},#{memberEmail}, #{memberPhoneNumber}, #{memberCellphoneNumber}, #{memberStatus}, #{memberTypeCode}, #{groupId}, #{authorityCode}, #{signUpAt}, #{memberUniqId}, #{positionCode}, #{departmentCode}, #{taskCode}, #{cooperativeId})
    </insert>

    <update id="updateMember" parameterType="MemberModel">
        UPDATE o_member
        set
        <if test="name != null and name !=''">
            name = #{name},
        </if>
        <if test="email != null and email !=''">
            email = #{email},
        </if>
        <if test="password != null and password !=''">
            password = #{password},
        </if>
        <if test="phoneNumber != null and phoneNumber !=''">
            phone_number = #{phoneNumber},
        </if>
        <if test="status != null and status !=''">
            status = #{status},
        </if>
        <if test="authorityCode != null and authorityCode !=''">
            authority_code = #{authorityCode},
        </if>
        <if test="positionCode != null and positionCode !=''">
            position_code = #{positionCode},
        </if>
        <if test="departmentCode != null and departmentCode !=''">
            department_code = #{departmentCode},
        </if>
        <if test="taskCode != null and taskCode !=''">
            task_code = #{taskCode},
        </if>
        <if test="typeCode != null and typeCode !=''">
            type_code = #{typeCode},
        </if>
        <if test="memberUniqId != null and memberUniqId !=''">
            member_uniq_id = #{memberUniqId},
        </if>
        update_at = CURRENT_TIMESTAMP(3)
        where member_id = #{memberId}
    </update>

    <update id="updatePassword" parameterType="MemberModel">
        UPDATE o_member
        set
            password = #{password}
        where member_id = #{memberId}
    </update>

    <delete id="deleteMember" parameterType="String">
        DELETE FROM o_member where member_id = #{memberId}
    </delete>


    <select id="findExistMemberId" parameterType="String" resultType="boolean">
        select count(*) > 0
        from o_member
        where member_id = #{memberId}
    </select>


    <select id="login" parameterType="MemberModel" resultType="MemberModel">
        select *
        from o_member
        where member_id = #{memberId} and password = #{password}
    </select>

    <select id="getLastMemberUniqId" resultType="String">
        SELECT MAX(member_id)
        FROM o_member
    </select>

</mapper>